/*-RSL----------------------------------------------------JV R-Style--*/
/*--------------- Печать мемориального ордера ------------------------*/
/*
 11.12.2009 Козловский М.Л. В форму МО до 2161-У добавлена печать паспортных
   данных вносителя из UserField и штампа банка ("ПРИНЯТО").
     В приходном кассвом ордере по 318-П уменьшена ширина, для операций
   по К 202 и 47422 вместо реквизитов получателя платежа используются реквизиты
   банка.
     В расходном кассовом ордере по 318-П уменьшена ширина, паспортные данные
   извлекаются из UserField. Если в UserField паспортных данных нет, они берутся
   из анкеты клиента-владельца счета плательщика.
     Для приходных и расходных ордеров реализована возможность печать данных
   доверенного лица, выполняющего операцию.
*/

 import plcommon,plcomrep;
 import brkstr, bankinter, vrslplat, i2order, fncommon, fm_all;
 import motools;

 record d (arhdoc  , "bank.def");
 FILE pers(person  , "bank.def");
 FILE sc  (symbcash, "bank.def");
 FILE cl  (client  , "bank.def");
 FILE clf (claddfrm, "bank.def");
 FILE acc (account , "bank.def");

 private array Symb, SymbSum;
 private var j;

/* ----------------------------------------------------- */
/* Вывод даты через точку   */
macro PutDatePoint( dat )
    Var Day, Mon, Year;
   datesplit( dat, Day, Mon, Year );
   return LZ(Day,2) + "." + LZ(Mon,2) + "." + LZ(Year,4);
end;
 
/* ----------------------------------------------------- */
 macro PrintMOold
  /* Подготовка строк к печати */
  ARRAY SS,SG,SBP,SBR,SP,SR;
  var payer,receiver,summa, poz,rub,kop,datedoc,dd,mm,yy,MFO_Banka_Res,Korschet_receiv;
  payer="ИНН"+d.OKPO_Payer+" "+d.Payer;
  receiver="ИНН"+d.OKPO_Receiver+" "+d.Receiver;
  strsplit( rubtostrAlt( d.Sum ),    SS,    63,63,2 );
  strsplit( d.Ground,             SG,    78,78,3 );
  strsplit( {Name_Bank},          SBP,   41,41,2 );
  strsplit( d.Bank_Receiver,      SBR,   41,41,2 );
  strsplit( payer,              SP,    41,41,3 );
  strsplit( receiver,           SR,    41,41,3 );

 Summa=string(Double(d.Sum*100));
 poz=index(Summa,".")-3;
 Rub=substr(Summa,1,poz);
 if(poz==-1)
 Kop=substr(00+Summa,poz+2,2);
 else
 Kop=substr(Summa,poz+1,2);
 end;                 


  if( d.SaveAutoKey > 0 )
     dateDoc = d.Date_Carry;    /* Архивный документ */
  else
     dateDoc = d.Date_Value;       /* Документ текущего дня */
  end;
  datesplit(dateDoc,dd,mm,yy);
  if(strlen(string(mm))==1)
     mm="0"+mm;
  end;
  if(StrLen(string(dd))=="1")
     dd="0"+dd;
  end;

  if(d.MFO_Receiver=="")
    MFO_Banka_Res={MFO_Bank};
    Korschet_receiv={CORAC_Bank};
  else
    Korschet_receiv=d.CorAcc_Receiver;
    MFO_Banka_Res=d.MFO_receiver;
  end;

 if (index (d.TypeDocument, "С") > 0)
[2                                                                     СПОД]
 end;
[2                                                                 ┌─────────┐
  МЕМОРИАЛЬНЫЙ ОРДЕР № #####      ##########                      │ 0481008 │
                                     дата                         └─────────┘

  Сумма    │ ################################################################
  прописью │ ################################################################
 ──────────┴──────────────────────────────┬───────┬──────────────────────────
 #########################################│ Сумма │ #####################-##
 #########################################│       │
 #########################################│───────┼──────────────────────────
 Плательщик                               │Счет № │ ####################
 ─────────────────────────────────────────┼───────│
 #########################################│  БИК  │ ##########
 #########################################│───────│
 Банк плательщика                         │Счет № │ ####################
 ─────────────────────────────────────────┼───────┼──────────────────────────
 #########################################│  БИК  │ ##########
 #########################################│───────│
 Банк получателя                          │Счет № │ ####################
 ─────────────────────────────────────────┼───────│
 #########################################│Счет N │ ####################
 #########################################│───────┼─────┬─────────┬──────────
 #########################################│Вид оп.│     │Срок плат│
                                          │Наз.пл.│     │Очер.плат│
 Получатель                               │ Код   │     │Рез. поле│
 ─────────────────────────────────────────└───────┴─────┴─────────┴──────────
 Назначение платежа,наименование товара, выполненных работ,№№ и даты товарных
 документов,НДС
 ############################################################################
 ############################################################################
 ############################################################################
 ────────────────────────────────────────────────────────────────────────────
         Подписи                                             Отметки банка


 ┌──────┐       ────────────────────────
 │ М.П. │
 └──────┘
                ────────────────────────

]


   (d.Numb_Document,
    d.date_Document,
/*    dd,mm,yy,*/
    SS(0),
    SS(1),
    SP(0),
    Rub:r,
    Kop,
    SP(1),
    SP(2),
    d.Real_Payer,
    SBP(0),
    {MFO_Bank},
    SBP(1),
    {CORAC_Bank},
    SBR(0),
    MFO_Banka_Res,
/*    d.MFO_Receiver,*/
    SBR(1),
    Korschet_receiv,
/*    d.CorAcc_Receiver,*/
    SR(0),
    d.Account_Receiver,
    SR(1),
    SR(2),
    SG(0),
    SG(1),
    SG(2));
 end;

macro PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg)

Array SS, SG;
var n, Ground="", , sumtostr="", SP, SR, SBR, SBP, NSP, NSR;
SP = SR = SBP = SBR = NSP = NSR = TArray(0, 1) ;

Array Pasp;
var i, StrPasp;
var Штамп0="+--------------------------+";
var Штамп1="|  БФ АКБ \X22СОФИЯ\X22 (ЗАО)    |";
var Штамп2="| К/С 30101810600000000826 |";
var Штамп3="|      БИК 046359826       |";
var Штамп4="|        "+ PutDatePoint(d.Date_Document) +"        |";
var Штамп5="|        ПРОВЕДЕНО         |";
var Штамп6="|"+ string (GetFIOOper({oper},true):26:c) +"|";
var Штамп7="+--------------------------+";
/*
  Payer="ИНН"+d.OKPO_Payer+" "+d.Payer;
  Receiver="ИНН"+d.OKPO_Receiver+" "+d.Receiver;
*/
  Payer=d.Payer;
  Receiver=d.Receiver;

 if (index (d.TypeDocument, "С") > 0)
[                                                                                      СПОД]
 end;

if ( d.Date_Document < {Date2161U} )

 PrintMOold

elif ( d.Date_Document >= {Date2161U} )                                        
 sumtostr =  rubtostralt( d.Sum );
 sumtostr = StrSubSt( sumtostr, SubStr( sumtostr, Index( sumtostr, "коп")+3), ".");
 strsplit( sumtostr, SS, 72, 72, 2);
 /*
 NSP = strsplit2( GetNameAc( d.Real_Payer), 40, true, 3);
 NSR = strsplit2( GetNameAc( d.Real_Receiver), 40, true, 3);
 */
 NSP = strsplit2(Payer, 40, true, 3);
 NSR = strsplit2(Receiver, 40, true, 3);
 strDateDoc =StrSubSt( strDateDoc, ".", "ода");  

// Не нужно добавлять. Все будет написано в назначении
// Ground = d.Ground+ " N " + d.Numb_Document + " от " + strDateDoc;
 Ground = d.Ground;
 strsplit( Ground,                        SG, 97, 97, 2 );

/*
 Не заменяем ".00" на "=" чтобы было соответсвие суммы прописью и суммы цифрами
 Sum = string( d.Sum); 
 if ( index(Sum,".00" ))
    Sum = StrSubSt( Sum, ".00", "="); 
 else
    Sum = StrSubSt( Sum, ".", "-");
 end;
*/

 [                                                                    +-----------------------------+
                                                                      | Код формы документа по ОКУД |
                                                                      +-----------------------------+
                                                                      |          0401108            |
    ##################################################################+-----------------------------+                                     
    -------------------------------------------------------------------------------------------------
    Составитель
 ]
  ( {Name_Bank}:l); 

 if (index (d.UserTypeDocument, "И") > 0)
 [    МЕМОРИАЛЬНЫЙ ИСПРАВИТЕЛЬНЫЙ ОРДЕР N   ###############          #######################
    -------------------------------------------------------------------------------------------------
                                                                               Дата
 ]
 ( 
   d.Numb_Document:c,
   strDateDoc:c
 );
 else
 [  МЕМОРИАЛЬНЫЙ ОРДЕР N   ###############            #######################
    -------------------------------------------------------------------------------------------------
                                                              Дата
 ]
 ( 
   d.Numb_Document:c,
   strDateDoc:c
 );
 end;
 [  ----------------------------------------+-------------------------+------------------------------
    Наименование счета                      |      Дебет счета        |Сумма цифрами
    ----------------------------------------+-------------------------+---------------+--------------
    ########################################|#########################|###############|
    ########################################|                         |               |
    ########################################|                         |               |
    ----------------------------------------+-------------------------+               |
    Наименование счета                      |      Кредит счета       |               |
    ----------------------------------------+-------------------------+               |
    ########################################|#########################|               |
    ########################################|                         |               |
    ########################################|                         |               |
    ----------------------------------------+-------------------------+------+--------+-----+--------
    Сумма прописью                                                           |Шифр документа|   ##
    #########################################################################+--------------+--------
    #########################################################################|              |
    -------------------------------------------------------------------------+--------------+--------
    Содержание операции, наименование, номер и дата документа, на основании
    которого составлен мемориальный ордер
    #################################################################################################
    #################################################################################################
    -------------------------------------------------------------------------------------------------
    Подписи                                                     
                #########################      #########################
    -------------------------------------------------------------------------------------------------
             Приложение: ###### документов на ######  листах.     ############################
                         ------               ------              ############################
                                                                  ############################
                                                                  ############################
                                                                  ############################
                                                                  ############################
                                                                  ############################
                                                                  ############################
 ]
 ( NSP(0):l,    
   d.Real_Payer:l,
   Sum:r,
   NSP(1):l,
   NSP(2):l,
   NSR(0):l,
   d.Real_Receiver:l,
   NSR(1):l,
   NSR(2):l,
   d.Shifr_oper:l,
   SS(0):l,
   SS(1):l,
   SG(0):l,
   SG(1):l,
   "",	//GetFioOper({FIO_Book}, true):l,
   "",	//GetFioOper( d.Oper, true):l,
   "1":c,
   "1":c,
   Штамп0, Штамп1, Штамп2, Штамп3, Штамп4, Штамп5, Штамп6, Штамп7
   );
end;
/*
  if(({oper} >= 28) AND ({oper} < 40)) /* Оперзал платежки печатает на лазерный принтер */
    [
    ];
  end;
*/
end;

macro PrintOVN(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato, date_318P)
Array SS,SP,SBP,SBR,SR,SG,NSP2,NSR2,S,SY, SS1,SS2, Symb, SymbSum;
var  rc,i,ns, r_account="", data, k, n, NSP, NSR, NSRK, strsum ="";
NSP = NSR = NSRK = TArray(0, 1);

   strsplit( rubtostralt( d.Sum ), SS,    64, 81, 2 );
   strsplit( d.Ground,             SG,    81, 64, 2 );

   NSP = strsplit2( d.Payer,    34, true, 3 ); // от кого
   NSR = strsplit2( d.Receiver, 32, true, 4 ); // кому

   strsplit( Payer,                SP,    43, 34, 3 );
   strsplit( Receiver,             SR,    43, 34, 4 );

   strsplit( d.Bank_Payer,         SBP,   36, 36, 2 );
   strsplit( d.Bank_Receiver,      SBR,   36, 36, 2 );
   strsplit( d.Payer,              NSP2,  36, 27, 3 ); // от кого
   strsplit( d.Receiver,           NSR2,  36, 24, 4 ); // кому

 S (0)="";
 SY(0)="";
 S (1)="";
 SY(1)="";
 S (2)="";
 SY(2)="";
 S (3)="";
 SY(3)="";

 if((d.Symbol_Cach ==" 0") OR (d.Symbol_Cach =="  0"))
    sc.Kind             = 1;
    sc.iApplicationKind = d.iApplicationKind;
    sc.ApplicationKey   = d.ApplicationKey;
    rc = GetGE(sc);
    ns=0;
    while(rc AND (sc.iApplicationKind == d.iApplicationKind) AND (sc.ApplicationKey == d.ApplicationKey))
      S (ns)=sc.Sum;
      SY(ns)=sc.Symbol;
      ns=ns+1;
      rc = Next(sc);
    end;
 else
   S (0)=d.Sum;
   SY(0)=d.Symbol_Cach;
   ns=1;
 end;

 if(ns<4)
   ns=4;
 end;

 if (d.Date_Document < date_318P)

[
 +-----------------------+-------+-------------------------------------------------+
 |      ОБЪЯВЛЕНИЕ  №    |#######|                                       +---------+
 |   на взнос наличными  +-------+                                       | 0402001 |
 |                                                                       +---------+
 |    ###################                                                          |
 |   ---------------------                               +-------------------------+
 |От кого  ################################## Для зачисл.|                         |
 |########################################### на счет №  |#########################|
 |###########################################            |                         |
 |Банк получателя   #####################################+-------------------------+
 |Получатель ################################            | ####################### |
 |###########################################            |                         |
 |###########################################            |     Сумма цифрами       |
 +-------------------------------------------------------+-------------------------+
 |#################################################################################|
 |Сумма прописью   ################################################################|
 +---------------------------------------------------------------------------------+
 |Источник взноса  ################################################################|
 | ################################################################################|
 +---------------------------------------------------------------------------------+
 |Подпись вносителя                   Бухгалтер          ######################### |
 |                 ------------------                    ------------------------- |
 |                                    Деньги принял кассир                         |
 |                                                          ---------------------- |
 +-----------------------+-------+-------------------------------------------------+
 |       КВИТАНЦИЯ  №    |#######|                                       +---------+
 |                       +-------+                                       | 0402001 |
 |                                                                       +---------+
 |      #################                                                          |
 |    ---------------------                              +-------------------------+
 |От кого  ################################## Для зачисл.|                         |
 |########################################### на счет №  |#########################|
 |###########################################            |                         |
 |Банк получателя   #####################################+-------------------------+
 |Получатель ################################            | ####################### |
 |###########################################            |                         |
 |###########################################            |      Сумма цифрами      |
 +-------------------------------------------------------+-------------------------+
 |#################################################################################|
 |Сумма прописью   ################################################################|
 +---------------------------------------------------------------------------------+
 |Источник взноса  ################################################################|
 |#################################################################################|
 +---------------------------------------------------------------------------------+
 |     М.П.      Бухгалтер               #########################                 |
 |                                       -------------------------                 |
 |               Деньги принял кассир                                              |
 |                                       -------------------------                 |
 +-----------------------+-------+-------------------------------------------------+
 |            ОРДЕР №    |#######|                                       +---------+
 |                       +-------+                                       | 0402001 |
 |                                                                       +---------+
 |      #################                       ДЕБЕТ                   Сумма      |
 |                                    +-------------------------+------------------+
 |От кого  ###########################|#########################|##################|
 |####################################+-------------------------+                  |
 |####################################|         КРЕДИТ          |                  |
 +------------------------------------+-------------------------+                  |
 |####################################|                         |      Общая       |
 |####################################|                         +-------------+----+
 |Банк получателя                     |                         |  частные    |симв|
 |------------------------------------+                         +-------------+----+
 |Получатель  ########################|#########################|#############|####|
 |####################################|                         +-------------+----+
 |####################################|                         |#############|####|
 |####################################|                         +-------------+----+
]
(   d.Numb_Document:c,
    strDateDoc:c,
    NSR(0):l,
    NSR(1):l, d.Account_Receiver:l,
    NSR(2):l,
    d.Bank_Receiver:l,
    NSR(0):l, Sum:r,
    NSR(1):l,
    NSR(2):l,
    SS(0):l, SS(1):l,
    SG(0):l, SG(1):l,
    Buhg:l,

    d.Numb_Document:c,
    strDateDoc:c,
    NSR(0):l,
    NSR(1):l, d.Account_Receiver:l,
    NSR(2):l,
    d.Bank_Receiver:l,
    NSR(0):l, Sum:r,
    NSR(1):l,
    NSR(2):l,
    SS(0):l, SS(1):l,
    SG(0):l, SG(1):l,
    Buhg:l,

    d.Numb_Document:c,
    strDateDoc:c,
    NSR(0):l, d.Account_Payer, Sum:r ,
    NSR(1):l,
    NSR(2):l,
    SBR(0):l,
    SBR(1):l,
    NSR2(0):l, d.Account_Receiver:l, S(0):f:r,SY(0):c,
    NSR2(1):l,
    NSR2(2):l, S(1):f:r,SY(1):c,
    NSR2(3):l
);

  i=2;
  while(i<ns-1)
[|                                    |                         |#############|####|
 |                                    |                         +-------------+----+
] (S(i):f:r,SY(i):c);
  i=i+1;
  end;

[|                                    |счет №                   |#############|####|
 +------------------------------------+-------------------------+-------------+----+
 |Источник взноса  ################################################################|
 |#################################################################################|
 | Бухгалтер                   Кассир                                              |
 | #########################                                                       |
 |                                                                                 |
 | -------------------------          ------------------------                     |
 +---------------------------------------------------------------------------------+
 
]
(
  S(ns-1):f:r,SY(ns-1):c,
  SG(0):l, SG(1):l,
  Buhg:l
);

 else  /*Объявление на взнос наличными нового образца (по 318-П)*/

    strsplit( d.Bank_Payer, SBP, 43, 39, 2 );
    NSR  = strsplit2( d.Receiver,  36, true, 9 );
    NSRK = strsplit2( d.Receiver,  58, true, 7 ); /* для блока Квитанция */
    strsplit( d.Bank_Receiver,      SBR,   36, 36, 20 );

    if ((IsFLAcc(d.Account_Receiver) != 1) AND (d.MFO_Receiver != ""))
        r_account = String(d.Account_Receiver);
    else
        r_account = "";
    end;

    strDateDoc =StrSubSt( strDateDoc, ".", "ода");  

    strsum = rubtostralt( d.Sum );
    strsum = StrSubSt( strsum, SubStr( strsum, Index( strsum, "коп")+3), ".");

    strsplit( strsum, SS,  98, 58, 2 );
    strsplit( strsum, SS1, 98, 83, 2 );
    strsplit( strsum, SS2, 97, 53, 2 );

    i = 0;
    while ( i < 20)
        S(i) = "";
        SY(i) = "";
        i = i+1;
    end;


    if((d.Symbol_Cach ==" 0") OR (d.Symbol_Cach =="  0"))
        sc.Kind             = 1;
        sc.iApplicationKind = d.iApplicationKind;
        sc.ApplicationKey   = d.ApplicationKey;
        rc = GetGE(sc);
        i=0;
        while(rc AND (sc.iApplicationKind == d.iApplicationKind) AND (sc.ApplicationKey == d.ApplicationKey))
            S(i)=sc.Sum;
            SY(i)=sc.Symbol;
            i=i+1;
            rc = Next(sc);
        end;
    else
        S (0)=d.Sum;
        SY(0)=d.Symbol_Cach;
        i=1;
    end;

[
                                                                                  +--------------------+
     Объявление на взнос наличными                                                |     Код формы      |
                                                                                  |  документа по ОКУД |
                    +-------+                                                     +--------------------+
     ОБЪЯВЛЕНИЕ  №  |#######|                                                     |      0402001       |
                    +-------+                                                     +--------------------+
     #####################
     ---------------------                                     ДЕБЕТ
                                              +--------------------------------+-----------------------+
     От кого                                  | Счет № ########################|                       |
     ######################################## +--------------------------------+    ################## |
     ########################################                                  |                       |
](   d.Numb_Document:c,
    strDateDoc:c,
    d.Account_Payer,
    NSR(0):l, Sum:r,
    NSR(1):l);

    n = 2;
    while ( (NSR(n+1) != "") AND (n<8))
        [    ########################################                                  |                       | ]( NSR(n):l);
        n=n+1;
    end;

[    ########################################                  КРЕДИТ          |                       |
     -----------------------------------------+--------------------------------+       Сумма цифрами   |
     Получатель                               | Счет № ########################|                       |
     ######################################## +--------------------------------+-----------------------+
]
(   NSR(n):l,
    d.Account_Receiver,
    NSR(0):l);

    n = 1;
    while ( (NSR(n+1) != "") AND (n<8))
        [    ########################################                                  |                       | ]( NSR(n):l);
        n=n+1;
    end;

[    ########################################                                  |     в том числе       |
     ##############################   ИНН   ############     КПП    #########  |     по символам:      |
     ------------------------------         ------------           ------------+-----------------------+
     р/счет №  #########################    ОКАТО  ###########                 |                       |
               --------------------------          ----------------------------+------+----------------+
     Наименование банка-вносителя  ########################################### |символ|   сумма        |
     --------------------------------------------------------------------------+------+----------------+
     #######################################################   БИК   ######### | #####|################|
     --------------------------------------------------------------------------+------+----------------+
     Наименование банка-получателя ########################################### | #####|################|
     --------------------------------------------------------------------------+------+----------------+
]
(
    NSR(n):l,   " ", inn:l, kpp:l,
    r_account:l,
    okato:l,
    SBP(0),
    SBP(1),  BIC_Payer:l,     SY(0):c,     S(0):r,
    SBR(0),  SY(1):c,         S(1):r
);

if ( S(4) != "")
    j = 0; k = 2;
    while (j < (i-4))
    [    ######################################################################### | #####|################|
         --------------------------------------------------------------------------+------+----------------+
    ]
    (SBR(j+1),  SY(k):c,     S(k):r);
    j = j+1;
    k = k+1;
    end;
else
    k = 2;
end;

[    #######################################################   БИК   ######### | #####|################|
     --------------------------------------------------------------------------+------+----------------+
     Сумма прописью ########################################################## | #####|################|
     --------------------------------------------------------------------------+------+----------------+
     ##################################################################################################
     --------------------------------------------------------------------------------------------------
                                                                                        (цифрами)
     Источник поступления  ############################################################################
     --------------------------------------------------------------------------------------------------
     ##################################################################################################
     --------------------------------------------------------------------------------------------------
     Подпись клиента                    Бухгалтерский работник            Кассовый работник
                                        #########################

     ------------------                 -------------------------         ------------------

     -----------------+-------+---------------------------------------------------+-------------------+
      КВИТАНЦИЯ  №    |#######|                                                   |     Код формы     |
                      +-------+                                                   | документа по ОКУД |
                                                                                  +-------------------+
     #####################                                                        |      0402001      |
     ---------------------                                       +----------------+-------------------+
     От кого                                                     |     Для зачисления на счет №       |
     ########################################################### |                                    |
     ########################################################### |     #########################      |
](   SBR(k-1),  BIC_Receiver:l,  SY(k):c,     S(k):r,
     SS(0):l, SY(k+1):c,        S(k+1):r,
     SS(1):l,
     SG(0):l,
     SG(1):l,
     GetFioOper(d.Oper,true):c,
     d.Numb_Document:c,
     strDateDoc:c,
     NSRK(0):l,
     NSRK(1):l,
     d.Account_Receiver);

     n = 2;
     while ( (NSRK(n) != "") AND (n<6))
        [    ########################################################### |                                    |](NSRK(n):l);
        n = n+1;
     end;

[    Получатель                                                  |                                    |];

     n = 0;
     while ( (NSRK(n+1) != "") AND (n<5))
        [    ########################################################### |                                    |](NSRK(n):l);
        n = n+1;
     end;

[    ########################################################### +------------------------------------+
     ИНН   ############      КПП    #########                    |           Сумма цифрами            |
           ------------            -----------                   |                                    |
     р/счет №  #########################    ОКАТО  ###########   |      #######################       |
               --------------------------          --------------+------------------------------------+
     Наименование банка-вносителя  ###################################################################
     --------------------------------------------------------------------------------------------------
     ############################################################################      БИК   #########
     ----------------------------------------------------------------------------           -----------
     Наименование банка-получателя  ###################################################################
     --------------------------------------------------------------------------------------------------
     ############################################################################      БИК   #########
     ----------------------------------------------------------------------------           -----------
     Сумма прописью ###################################################################################
     --------------------------------------------------------------------------------------------------
     ##################################################################################################
     --------------------------------------------------------------------------------------------------
     Источник поступления  ###########################################################  (цифрами)
     --------------------------------------------------------------------------------------------------
     ##################################################################################################
     --------------------------------------------------------------------------------------------------
     Место печати       Бухгалтерский работник            Кассовый работник
      (штампа)          #########################

                        -------------------------         ------------------

     -----------------+-------+---------------------------------------------------+-------------------+
      ОРДЕР  №        |#######|                                                   |     Код формы     |
                      +-------+                                                   | документа по ОКУД |
                                                                                  +-------------------+
      #####################                                                       |      0402001      |
      ---------------------                                                       +-------------------+
                                                                     ДЕБЕТ
                                           +--------------------------------+-------------------------+
      От кого                              | Счет № ########################|                         |
      #################################### +--------------------------------+  ###################### |
](    NSRK(n):l,
      inn:l, kpp:l,
      r_account:l,  okato:l, Sum:r,
      SBP(0),
      SBP(1),  BIC_Payer:l,
      SBR(0),
      SBR(1),  BIC_Receiver:l,
      SS1(0):l,
      SS1(1):l,
      SG(0):l,
      SG(1):l,
      GetFioOper(d.Oper,true):c,
      d.Numb_Document:c,
      strDateDoc:c,
      d.Account_Payer:l,
      NSR(0):l, Sum:r);

      n = 1;
      while ( (NSR(n+1) != "") AND (n<8) )
        [     ####################################                                  |                         | ]( NSR(n):l);
        n = n+1;
      end;

[     ####################################                  КРЕДИТ          |                         |
      -------------------------------------+--------------------------------+                         |
      Получатель                           | Счет № ########################|     Сумма цифрами       |
      #################################### +--------------------------------+-------------------------+
](    NSR(n):l,
      d.Account_Receiver:l,
      NSR(0):l);

      n = 1;
      while ( (NSR(n+1) != "") AND (n<8) )
        [     ####################################                                  |                         |](  NSR(n):l);
        n = n+1;
      end;


[     ####################################                                  |     в том числе         |
      ###############################   ИНН  ############  КПП  #########   |     по символам:        |
      -------------------------------        ------------       ------------+-------------------------+
      р/счет №  #########################    ОКАТО  ###########             |                         |
               --------------------------           ------------------------+------+------------------+
      Наименование банка-вносителя  ####################################### |символ|   сумма          |
      ----------------------------------------------------------------------+------+------------------+
      #################################################     БИК   ######### | #####|##################|
      ----------------------------------------------------------------------+------+------------------+
      Наименование банка-получателя ####################################### | #####|##################|
      ----------------------------------------------------------------------+------+------------------+
]
(

    NSR(n):l,
    " ",   inn:l, kpp:l,
    r_account:l,
    okato:l,
    SBP(0),
    SBP(1),  BIC_Payer:l,     SY(0):c,     S(0):r,
    SBR(0),  SY(1):c,     S(1):r
);

if ( S(4) != "")
    j = 0; k = 2;
    while (j < (i-4))
    [ ######################################################################### | #####|##################|
      --------------------------------------------------------------------------+------+------------------+
    ]
    (SBR(j+1),  SY(k):c,     S(k):f:r);
    j = j+1;
    k = k+1;
    end;
else
    k = 2;
end;

[     ##################################################    БИК   ######### | #####|##################|
      ----------------------------------------------------------------------+------+------------------+
      Сумма прописью  ##################################################### | #####|##################|
      ----------------------------------------------------------------------+------+------------------+
      #################################################################################################
      -------------------------------------------------------------------------------------------------
                                                                                         (цифрами)
      Источник поступления  ###########################################################################
      -------------------------------------------------------------------------------------------------
      #################################################################################################
      --------------------------------------------------------------------------------------------------
                              Бухгалтерский работник            Кассовый работник
                              #########################

                              -------------------------         ------------------

]
(   
    
   
    SBR(k-1),  BIC_Receiver:l,  SY(k):c,     S(k):f:r,
    SS2(0):l, SY(k+1):c,     S(k+1):f:r,
    SS2(1):l,
    SG(0):l,
    SG(1):l,
    GetFioOper(d.Oper,true):c
);
end;
end;

macro PrintRC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato, date_318P)
Array SS,SP,SBR,SR,SG,NSP,NSR,S,SY,SD,SBP;
var   rc,i,ns,doc,CodeCurr, r_account, n=0, NSRN, SBRN, SBPN, NSPN;
var   Receiv;
NSRN = SBRN = SBPN = NSPN = TArray(0, 1);

   strsplit( rubtostralt( d.Sum ), SS,    81,66,2 );
   strsplit( d.Ground,             SG,    81,62,2 );
   strsplit( d.Bank_Receiver,      SBR,   37,21,2 );
   strsplit( d.Payer,              NSP,   37,29,3 ); // от кого
   strsplit( d.Receiver,           NSR,   37,26,4 ); // кому
   strsplit( Payer,                SP,    37,29,3 );
   strsplit( Receiver,             SR,    37,29,4 );

 S (0)="";
 SY(0)="";
 S (1)="";
 SY(1)="";

 if((d.Symbol_Cach ==" 0") OR (d.Symbol_Cach =="  0"))
     sc.Kind             = 1;
     sc.iApplicationKind = d.iApplicationKind;
     sc.ApplicationKey   = d.ApplicationKey;

     rc = GetGE(sc);
     ns=0;
     while(rc AND (sc.iApplicationKind == d.iApplicationKind) AND (sc.ApplicationKey == d.ApplicationKey))
        if ( CheckTS( sc.Symbol, LSTS_INCR ) )
           S (ns)=sc.Sum;
           SY(ns)=sc.Symbol;
           ns=ns+1;
        end;
        rc = Next(sc);
     end;
 else
    if ( CheckTS( d.Symbol_Cach, LSTS_INCR ) )
       S (0)=d.Sum;
       SY(0)=d.Symbol_Cach;
    end;
    ns=1;
 end;

 if(ns<2)
   ns=2;
 end;

 doc = GetClientDocument(d.Account_Receiver);
 strsplit( doc, SD, 81,81,2 );

 if( d.Date_Document < PR_NEWDATE ) // приходный кассовый ордер СТАРОГО образца

    [

     +---------------------------------------------------------------------------------+
     |     ПРИХОДНЫЙ         +-------+                                                 |
     |     КАССОВЫЙ ОРДЕР №  |#######|                                                 |
     |                       +-------+                                                 |
     |   ###################                                                           |
     |  ---------------------                        Дебет                  Сумма      |
     |От кого #############################+-------------------------+-----------------+
     |#####################################|#########################|#################|
     |#####################################|                         | Общая           |
     +-------------------------------------+-------------------------+------------+----+
     |Банк получателя #####################|     Кредит              | Частные    |Симв|
     |#####################################+-------------------------+------------+----+
     |Получатель ##########################|#########################|############|####|
     |#####################################|                         +------------+----+
     |#####################################|                         |############|####|
     |#####################################|                         +------------+----+
    ]
    (
      d.Numb_Document:c,
        strDateDoc:c,
        NSR(0):l,
        NSR(1):l, d.Account_Payer:l, Sum:r ,
        NSR(2):l,
        SBR(0):l, SBR(1):l,
        NSR(0):l, d.Account_Receiver:l, S(0):f:r,SY(0):c,
        NSR(1):l,
        NSR(2):l, S(1):f:r,SY(1):c,
        NSR(3):l
    );
      i=2;
      while(i<ns)
    [|                                     |                         |############|####|
     |                                     |                         +------------+----+
    ] (S(i):r,SY(i):c);
      i=i+1;
      end;

    [|                                     |                         | Шифр опер. | ## |
     +-------------------------------------+-------------------------+------------+----+
     |Назначение платежа ##############################################################|
     |#################################################################################|
     +---------------------------------------------------------------------------------+
     |Сумма прописью ##################################################################|
     |#################################################################################|
     +---------------------------------------------------------------------------------+
     |#################################################################################|
     |#################################################################################|
     |                                                                                 |
     |Подпись вносителя                                                                |
     |                 -------------------                                             |
     |Гл. бухгалтер               Бухгалтер                         Кассир             |
     |#########################   #########################                            |
     |                                                                                 |
     |-------------------------   -------------------------         ------------------ |
     +---------------------------------------------------------------------------------+
    ]
    (
       d.Shifr_Oper:c,
       SG(0):l, SG(1):l,
       SS(0):l, SS(1):l,
       SD(0):l, SD(1):l,
       GetFioOper({FIO_Book},true):l, Buhg:l
    );
  /* приходный кассовый ордер  по 199-П*/
  elif (d.Date_Document < date_318P)
    i = 1;
    sc.Kind             = 1;
    sc.iApplicationKind = d.iApplicationKind;
    sc.ApplicationKey   = d.ApplicationKey;

    if(GetEQ(sc))
       if ( CheckTS( sc.Symbol, LSTS_INCR ) )
          Symb(0)    = sc.Symbol;
          SymbSum(0) = sc.Sum;
       else
          Symb(0)    = "";
          SymbSum(0) = "";
          i = 0;
       end;
    else
       if ( CheckTS( d.symbol_cach, LSTS_INCR ) )
          Symb(0)    = d.symbol_cach;
          SymbSum(0) = d.Sum;
       else
          Symb(0)    = "";
          SymbSum(0) = "";
       end;
       Symb(1)    = "";
       Symb(2)    = "";
       Symb(3)    = "";
       SymbSum(1) = "";
       SymbSum(2) = "";
       SymbSum(3) = "";
    end;

    while( next(sc)
           and (sc.Kind             == 1                  )
           and (sc.iApplicationKind == d.iApplicationKind )
           and (sc.ApplicationKey   == d.ApplicationKey   ) )
       if ( CheckTS( sc.Symbol, LSTS_INCR ) )
          Symb(i)    = sc.Symbol;
          SymbSum(i) = sc.Sum;
          i = i + 1;
       end;
    end;

    j = 0;
    while( j < 4 )
       if ( (ValType(Symb(j)) == V_UNDEF) and (ValType(SymbSum(j)) == V_UNDEF) )
          Symb(j)    = "";
          SymbSum(j) = "";
       end;
       j = j + 1;
    end;

    CodeCurr = d.Code_Currency;
    if(CodeCurr == 0)
        CodeCurr = 810;
    end;

    strsplit( d.Bank_Receiver,      SBR, 53, 53, 2 );
    strsplit( rubtostralt( d.Sum ) + " (" + CodeCurr + ")", SS, 79, 36, 3 );
    strsplit( d.Receiver,           NSR, 53, 53, 2 );
    strsplit( d.Ground,             SG,  79, 63, 2 );

    [
                                      +-------+
           Приходный кассовый ордер № |#######|
              ###################     +-------+
                                                                         ДЕБЕТ
                                                               +----------------------------+------------------------+
          От кого                                              |сч.№ #######################|                        |
          #####################################################|                            | ###################### |
          -----------------------------------------------------+----------------------------+                        |
          #####################################################          КРЕДИТ             |                        |
          -----------------------------------------------------+----------------------------+                        |
          Банк получателя ######### ###########################|сч.№ #######################|                        |
          -----------------------------------------------------+                            |                        |
          Получатель ##########################################|                            |                        |
          -----------------------------------------------------+----------------------------+      Сумма цифрами     |
                                                                                            +------------------------+
          Сумма прописью (наименование (код) валюты) ####################################   |
                                                     ---------------------------------------+
          ###############################################################################   |
          ----------------------------------------------------------------------------------+
          ###############################################################################   |в том числе по символам:
          ----------------------------------------------------------------------------------+------------+-----------+
                                                                                            |  сумма     |  символ   |
                                                                                            +------------+-----------+
                                                                                            |############|###########|
                                                                                            +------------+-----------+
                                                                                            |############|###########|
                                                                                            +------------+-----------+
          Источник взноса ###############################################################   |############|###########|
                          ------------------------------------------------------------------+------------+-----------+
          ###############################################################################   |############|###########|
          ----------------------------------------------------------------------------------+------------+-----------+

          Подпись вносителя                  Бухгалтерский работник      Кассовый работник

          ################################   ##########################

              М.П.
    ]
    ( d.Numb_Document:l,
      strDateDoc:c,
      d.Real_Payer,
      NSR(0),
      Sum:c,
      NSR(1),
      BIC_Receiver,
      d.bank_Receiver,
      d.Real_Receiver,
      NSR(0),
      SS(0):l,
      SS(1):l,
      SS(2):l,
      SymbSum(0):f,
      Symb(0):c,
      SymbSum(1):f,
      Symb(1):c,
      SG(0),
      SymbSum(2):f,
      Symb(2):c,
      SG(1),
      SymbSum(3):f,
      Symb(3):c,
      GetDover (d.Account_Receiver, d.iApplicationKind, d.ApplicationKey):w,
      GetFioOper(d.Oper,true):c);
 /* приходный кассовый ордер по 318-П */
 else

    StrSet(strDateDoc, strlen(strDateDoc), "о");
    strDateDoc = strDateDoc + "да";

    sc.Kind             = 1;
    sc.iApplicationKind = d.iApplicationKind;
    sc.ApplicationKey   = d.ApplicationKey;

    i = 0;  n = 0;
    while ( i < 20)
        Symb(i) = "";
        SymbSum(i) = "";
        i = i+1;
    end;

    if(GetEQ(sc))
       if ( CheckTS( sc.Symbol, LSTS_INCR ) )
          Symb(0)    = sc.Symbol;
          SymbSum(0) = sc.Sum;
          i = 1;
       else
          Symb(0)    = "";
          SymbSum(0) = "";
          i = 0;
       end;
    else
       if ( CheckTS( d.symbol_cach, LSTS_INCR ) )
          Symb(0)    = d.symbol_cach;
          SymbSum(0) = d.Sum;
          i = 1;
       else
          Symb(0)    = "";
          SymbSum(0) = "";
          i = 0;
       end;
    end;

    while( next(sc)
           and (sc.Kind             == 1                  )
           and (sc.iApplicationKind == d.iApplicationKind )
           and (sc.ApplicationKey   == d.ApplicationKey   ) )
       if ( CheckTS( sc.Symbol, LSTS_INCR ) )
          Symb(i)    = sc.Symbol;
          SymbSum(i) = sc.Sum;
          i = i + 1;
       end;
    end;

    j = 0;
    while( j < i )
       if ( (ValType(Symb(j)) == V_UNDEF) and (ValType(SymbSum(j)) == V_UNDEF) )
          Symb(j)    = "";
          SymbSum(j) = "";
       end;
       j = j + 1;
    end;

    SBRN = strsplit2( d.Bank_Receiver, 48, true, 20 );
    strsplit( rubtostralt( d.Sum ), SS, 78, 31, 3 );

    if ((substr (d.Real_Receiver, 1, 3) == "202") or (substr (d.Real_Receiver, 1, 5) == "47422"))
      NSRN = strsplit2( {Name_Bank}, 45, true, 8);
      inn = {INN};
      kpp = {Bank_KPP};
      okato = {COATO_Code};
    else
      NSRN = strsplit2( d.Receiver, 45, true, 8);
    end;

    strsplit( d.Ground,             SG,  108, 87, 2 );
    SBPN = strsplit2( d.Bank_Payer, 48, true, 3 );
    NSPN = strsplit2( d.Payer, 45, true, 8);

    if ((IsFLAcc(d.Account_Receiver) != 1) AND (d.MFO_Receiver != ""))
        r_account = String(d.Account_Receiver);
    else
        r_account = "";
    end;

   [E(3R(s0p14h0s3b4102T&l8D&l0O
                                                                                                +------------------+
                                                                                                |    Код формы     |
                                                                                                | документа по ОКУД|
                                                                                                +------------------+
                                                                                                |     0402008      |
                                                                                                +------------------+
                                    +-------+                                        
         Приходный кассовый ордер № |#######|                                        
            #####################   +-------+                                        
            ---------------------                                                     
                                                                       ДЕБЕТ
                                                      +--------------------------------+---------------------------+
        От кого                                       | Счет № ########################|                           |
        ############################################# |                                |  ######################## |]
  (                                                                                                              
      d.Numb_Document:c,                                                                                         
      strDateDoc:c,                                                                                              
      d.Account_Payer:l,                                                                                         
      NSPN(0):l,        Sum:r                                                                                    
  );                                                                                                             
                                                                                                                 
                                                                                                                 
  n = 1;                                                                                                         
  while ( (NSPN(n)!="") AND (n<6))                                                                               
    [    ############################################# |                                |                           |]( NSPN(n):l);
    n = n+1;                                                                                                     
  end;                                                                                                           
  [    ----------------------------------------------+--------------------------------+                           |
                                                                      КРЕДИТ          |                           |
       ----------------------------------------------+--------------------------------+                           |
       Получатель                                    | Счет № ########################|                           |
  ]                                                                                                              
  (   d.Account_Receiver:l);                                                                                     
                                                                                                                 
  if ( NSRN(3)!="" )                                                                                             
  [    ############################################# |                                |                           |
       ############################################# |                                |                           |
  ](    NSRN(0):l,
        NSRN(1):l);
  else
    NSRN(4) = NSRN(2);
    NSRN(2) = NSRN(0);
    NSRN(3) = NSRN(1);
  end; 


  [    ############################################# +--------------------------------+         Сумма цифрами     |
       ############################################# | Счет №                         |                           |
       ############################################# |                                |                           |
  ]( NSRN(2):l,                                                                                 
     NSRN(3):l,                                                                                 
     NSRN(4):l);                                                                                
                                                                                                
  n = 5;                                                                                        
  while ( ( NSRN(n) != "" ) AND (n<8) )                                                         
    [    ############################################# |                                                            |](NSRN(n):l);
    n=n+1;                                                                                      
  end;                                                                                          
                                                                                                
  [    ----------------------------------------------+--------------------------------+---------------------------+
       ИНН  ############           КПП  #########          ОКАТО  ###########         |        в том числе        |
           -------------               ----------                ------------         |        по символам:       |
       р/счет №  #########################                                            |                           |
                ----------------------------------------------------------------------+--------+------------------+
       Наименование банка-вносителя  ################################################ | символ | сумма            |
  ]
  ( inn:l,  kpp:l,  okato:l,
    r_account:l,
    SBPN(0):l);                                                            
    
  n = 1;
  while ( (ValType (SBPN(n+1)) != V_UNDEF) AND ( SBPN(n+1) != "") AND ( SBPN(n+1) != " ") )
  [    -------------------------------------------------------------------------------+        |                  |
       ############################################################################## |        |                  |
  ]( SBPN(n):l);
  n = n+1;
  end;   

  [    -------------------------------------------------------------------------------+--------+------------------+
       ##########################################################     БИК   ######### |  ##### |##################|
       -------------------------------------------------------------------------------+--------+------------------+
       Наименование банка-получателя ################################################ |  ##### |##################|
       -------------------------------------------------------------------------------+--------+------------------+
   ]
   (  
      SBPN(n):l,  BIC_Payer:l,     Symb(0):c,     SymbSum(0):f:r,
      SBRN(0):l,  Symb(1):c,       SymbSum(1):f:r
   );


   
   if ( (Symb(2) == "") OR ((Symb(2) != "") and (Symb(3) == "")) )
    [    ############################################################################## |  ##### |##################|
         -------------------------------------------------------------------------------+--------+------------------+
    ]
    (SBRN(1):l,  Symb(2):c,       SymbSum(2):f:r);
    j = 3;
    if  ( (ValType (SBRN(3)) != V_UNDEF) AND ( SBRN(3) != "") AND ( SBRN(3) != " ") )
       [    ############################################################################## |  ##### |##################|
            -------------------------------------------------------------------------------+--------+------------------+
       ] (SBRN(2):l,  "", "");   
       j = 4;
    end;
   else
        j = 2;
        while ( j< i-1 )
            [    ############################################################################## |  ##### |##################|
                 -------------------------------------------------------------------------------+--------+------------------+
            ]
            (SBRN(j-1):l,  Symb(j):c,       SymbSum(j):f:r);
            j = j+1;
        end;
   end;



   [    ###########################################################    БИК   ######### |  ##### |##################|                                                                            
        -------------------------------------------------------------------------------+--------+------------------+
        Сумма прописью с указанием наименования валюты ############################### |  ##### |##################|
                                                       --------------------------------+--------+------------------+
        ############################################################################################################
        ------------------------------------------------------------------------------------------------------------
        ############################################################################################################
        ------------------------------------------------------------------------------------------------------------
        Источник поступления #######################################################################################
        ------------------------------------------------------------------------------------------------------------
        ############################################################################################################
        ------------------------------------------------------------------------------------------------------------

        Подпись вносителя                                 Бухгалтерский работник              Кассовый работник
        ##########################################        ##########################


        ------------------------------------------        --------------------------          ----------------------

    ]
    ( 
      SBRN(j-1):l,      BIC_Receiver:l,    Symb(j):c,        SymbSum(j):f:r,
      SS(0):l,         Symb(j+1):c,       SymbSum(j+1):f:r,
      SS(1):l,   
      SS(2):l,
      SG(0):l,
      SG(1):l,
      GetDover (d.Account_Receiver, d.iApplicationKind, d.ApplicationKey):w,
      ""/*GetFioOper(d.Oper,true):c*/
    );
 end;

 if((({oper} >= 28) AND ({oper} < 40)) OR ({oper} >= 9000)) /* Оперзал платежки печатает на лазерный принтер */
  [
  ];
 end;
end;

macro PrintOC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, date_318P)
Array SS,SP,SBR,SR,SG,NSP,NSR,S,SY,SD, Symb, SymbSum;
var  rc,i,ns,doc,CodeCurr, nameDoc = "", numbDoc = "", placeDoc = "", dateDoc = "", strDoc1 = "", strDoc2 = "", n, NSPN = TArray(0, 1), SBRN = TArray(0, 1);


   strsplit( rubtostralt( d.Sum ), SS,    81,66,2 );
   strsplit( d.Ground,             SG,    43,62,3 );
   strsplit( d.Bank_Receiver,      SBR,   37,37,2 );
   strsplit( d.Payer,              NSP,   38,30,3 ); // от кого
   strsplit( d.Receiver,           NSR,   38,30,4 ); // кому
   strsplit( Payer,                SP,    38,30,3 );
   strsplit( Receiver,             SR,    38,30,4 );

 S (0)="";
 SY(0)="";
 S (1)="";
 SY(1)="";
 if((d.Symbol_Cach ==" 0") OR (d.Symbol_Cach =="  0"))
     sc.Kind             = 1;
     sc.iApplicationKind = d.iApplicationKind;
     sc.ApplicationKey   = d.ApplicationKey;

     rc = GetGE(sc);
     ns=0;
     while(rc AND (sc.iApplicationKind == d.iApplicationKind) AND (sc.ApplicationKey == d.ApplicationKey))
        if ( CheckTS( sc.Symbol, LSTS_DECR ) )
           S (ns)=sc.Sum;
           SY(ns)=sc.Symbol;
           ns=ns+1;
        end;
        rc = Next(sc);
     end;
 else
    if ( CheckTS( d.Symbol_Cach, LSTS_DECR ) )
       S (0)=d.Sum;
       SY(0)=d.Symbol_Cach;
    end;
    ns=1;
 end;

 if(ns<2)
   ns=2;
 end;

 doc = GetClientDocument(d.Account_Payer);
 strsplit( doc, SD, 81, 81, 2 );

 if( d.Date_Document < PR_NEWDATE ) // расходный кассовый ордер СТАРОГО образца

    [
     +-------------------------------------+-------------------------+-----------------+
     |     РАСХОДНЫЙ                       |        место  для       |                 |
     |     КАССОВЫЙ ОРДЕР № #######        |         наклейки        |    № #######    |
     |                                     |          талона         |  талон в кассу  |
     |   ###################               |                         |                 |
     |  ---------------------              +-------------------------+-----------------+
     |Выдать ##############################|          Дебет          |     Сумма       |
     |#####################################|#########################|#################|
     |#####################################|                         |                 |
     |                                     +-------------------------+                 |
     |                                     |          Кредит         |                 |
     |#####################################|                         +------------+----+
     |Наименование банка                   |#########################| Частные    |Симв|
     +-------------------------------------+-------------------------+------------+----+
     |Назначение платежа ########################################### |############|####|
     |############################################################## +------------+----+
     |                                                               |############|####|
     |                                                               +------------+----+
    ]
    (
      d.Numb_Document:c,d.Numb_Document:c,
        strDateDoc:c,
        NSP(0):l,
        NSP(1):l, d.Account_Payer:l, Sum:r ,
        NSP(2):l,
        d.Bank_Receiver, d.Account_Receiver:l,
        SG(0),  S(0):r,SY(0):c,
        SG(1),  S(1):r,SY(1):c
    );
      i = 2;
      while( i < ns )
    [|                                                               |############|####|
     |                                                               +------------+----+
    ] (S(i):r,SY(i):c);
      i = i + 1;
      end;

    [|                                                               | Шифр опер. | ## |
     +---------------------------------------------------------------+------------+----+
     |Сумма прописью ##################################################################|
     |#################################################################################|
     +---------------------------------------------------------------------------------+
     |#################################################################################|
     |#################################################################################|
     |                                                                                 |
     |Указанную в ордере сумму получил                                                 |
     |                                 -------------------------------                 |
     |Гл. бухгалтер                  Бухгалтер                      Кассир             |
     |#########################   #########################                            |
     |                                                                                 |
     |-------------------------   -------------------------         ------------------ |
     +---------------------------------------------------------------------------------+
    ]
    (
       d.Shifr_Oper:c,
       SS(0):l, SS(1):l,
       SD(0):l, SD(1):l,
       GetFioOper({FIO_Book},true):l, Buhg:l

    );
 elif (d.Date_Document < date_318P) // расходный кассовый ордер  образца (199-П)
    i = 1;
    sc.Kind             = 1;
    sc.iApplicationKind = d.iApplicationKind;
    sc.ApplicationKey   = d.ApplicationKey;

    if(GetEQ(sc))
        if ( CheckTS( sc.Symbol, LSTS_DECR ) )
           Symb(0)    = sc.Symbol;
           SymbSum(0) = sc.Sum;
        else
           Symb(0)    = "";
           SymbSum(0) = "";
           i = 0;
        end;
    else
        if ( CheckTS( d.Symbol_Cach, LSTS_DECR ) )
           Symb(0)    = d.symbol_cach;
           SymbSum(0) = d.Sum;
        else
           Symb(0)    = "";
           SymbSum(0) = "";
        end;
        Symb(1)    = "";
        Symb(2)    = "";
        Symb(3)    = "";
        SymbSum(1) = "";
        SymbSum(2) = "";
        SymbSum(3) = "";
    end;

    While(next(sc)
         and (sc.Kind             == 1                  )
         and (sc.iApplicationKind == d.iApplicationKind )
         and (sc.ApplicationKey   == d.ApplicationKey   ) )
       if ( CheckTS( sc.Symbol, LSTS_DECR ) )
          Symb(i)    = sc.Symbol;
          SymbSum(i) = sc.Sum;
          i = i + 1;
       end;
    end;

    j = 0;
    While( j < 4 )
       if ((ValType(Symb(j)) == V_UNDEF) and (ValType(SymbSum(j)) == V_UNDEF))
          Symb(j)="";
          SymbSum(j)="";
       end;
       j = j + 1;
    end;

    CodeCurr = d.code_currency;

    if(CodeCurr == 0)
        CodeCurr = 810;
    end;

    strsplit( d.Payer,              NSP,   53,  46,  3 );
    strsplit( rubtostralt( d.Sum ) + " (" + CodeCurr + ")", SS, 79, 30, 3 );
    strsplit( d.Ground,             SG,    69,  50,  4 );

    SetDocParm( acc, d.Account_Payer, d.Code_Currency, @nameDoc, @numbDoc, @placeDoc, @dateDoc );


    [
                                      +-------+                                   МЕСТО ДЛЯ
           Расходный кассовый ордер № |#######|                                НАКЛЕЙКИ ТАЛОНА
                                      +-------+
              ###################                                        ДЕБЕТ
                                                               +----------------------------+------------------------+
                                                               |сч.№ #######################| № талона               |
          Выдать ##############################################|                            | в кассу                |
                 ----------------------------------------------+----------------------------+                        |
          #####################################################          КРЕДИТ             | #                      |
          -----------------------------------------------------+----------------------------+------------------------+
          #####################################################|сч.№ #######################| ###################### |
          -----------------------------------------------------+                            |                        |
          #####################################################|                            |                        |
                                           +-------------------+                            |                        |
          Наименование банка               | БИК  #########    |                            |     Сумма цифрами      |
          ---------------------------------+-------------------+----------------------------+------------------------+
          Назначение платежа                                                                |
                             ##################################################             |в том числе по символам:
                             --------------------------------------------------             +------------+-----------+
          #####################################################################             |   сумма    |  символ   |
          ---------------------------------------------------------------------             +------------+-----------+
          #####################################################################             |############|###########|
          ---------------------------------------------------------------------             +------------+-----------+
          #####################################################################             |############|###########|
          ----------------------------------------------------------------------------------+------------+-----------+
          Сумма прописью (наименование (код) валюты) ####################################   |############|###########|
                                                     ---------------------------------------+------------+-----------+
          ###############################################################################   |############|###########|
          ----------------------------------------------------------------------------------+------------+-----------+

          Предъявлен документ, удостоверяющий личность ####################################, № ####################
                                                      -------------------------------------    --------------------
          Выдан ################################################################### ########## г.
                ------------------------------------------------------------------- ----------
          Указанную в ордере сумму получил
                                               ______________________
                                                (подпись получателя)

          Контролирующий работник                   Бухгалтерский работник                      Кассовый работник

                                                   ########################

    ]
    ( d.Numb_Document:l,
      strDateDoc:c,
      d.Real_Payer,
      NSP(0),
      NSP(1),
      d.Numb_Document:l,
      NSP(2),
      d.Real_Receiver,
      Sum:r,
      d.Bank_Receiver,
      BIC_receiver,
      SG(0),
      SG(1),
      SG(2),
      SymbSum(0),
      Symb(0):c,
      SG(3),
      SymbSum(1),
      Symb(1):c,
      SS(0):l,
      SymbSum(2),
      Symb(2):c,
      SS(1):l,
      SymbSum(3),
      Symb(3):c,
      nameDoc:l, numbDoc:l,
      placeDoc:l, dateDoc:l,
      GetFioOper(d.Oper,true):c );
 /* расходный кассовый ордер по 318-П*/
 else

    StrSet(strDateDoc, strlen(strDateDoc), "о");
    strDateDoc = strDateDoc + "да";

    sc.Kind             = 1;
    sc.iApplicationKind = d.iApplicationKind;
    sc.ApplicationKey   = d.ApplicationKey;

    i = 0;
    while ( i < 50)
        Symb(i) = "";
        SymbSum(i) = "";
        i = i+1;
    end;

    if(GetEQ(sc))
        if ( CheckTS( sc.Symbol, LSTS_DECR ) )
           Symb(0)    = sc.Symbol;
           SymbSum(0) = sc.Sum;
           i = 1;
        else
           Symb(0)    = "";
           SymbSum(0) = "";
           i = 0;
        end;
    else
        if ( CheckTS( d.Symbol_Cach, LSTS_DECR ) )
           Symb(0)    = d.symbol_cach;
           SymbSum(0) = d.Sum;
           i = 1;
        else
           Symb(0)    = "";
           SymbSum(0) = "";
           i = 0;
        end;

    end;

    While(next(sc)
         and (sc.Kind             == 1                  )
         and (sc.iApplicationKind == d.iApplicationKind )
         and (sc.ApplicationKey   == d.ApplicationKey   ) )
       if ( CheckTS( sc.Symbol, LSTS_DECR ) )
          Symb(i)    = sc.Symbol;
          SymbSum(i) = sc.Sum;
          i = i + 1;
       end;
    end;

    j = 0;
    While( j < i )
       if ((ValType(Symb(j)) == V_UNDEF) and (ValType(SymbSum(j)) == V_UNDEF))
          Symb(j)="";
          SymbSum(j)="";
       end;
       j = j + 1;
    end;


    NSPN = strsplit2( d.Payer, 50, true, 7 );
    strsplit( d.Ground,             SG,    79,  60,  20 );
    SBRN = strsplit2( d.Bank_Receiver, 32, true, 10 );
    strsplit( rubtostralt( d.Sum ), SS,    81,32,2 );

    SetDocParm( acc, d.Account_Payer, d.Code_Currency, @nameDoc, @numbDoc, @placeDoc, @dateDoc );

    if (nameDoc != "")
        strDoc1 = "Предъявлен документ, удостоверяющий личность:" + " " + nameDoc + " № " + numbDoc;
        strDoc2 = "Выдан" + " " + placeDoc + " " + dateDoc;
    else
      if (index (StrUpr (d.UserField1), "ПАСПОРТ") > 0)
        strDoc1 = "Предъявлен документ, удостоверяющий личность:" + " " + trim (d.UserField1);
        if (trim (d.UserField2) != "")
          strDoc1 = strDoc1 + " № " + trim(d.UserField2);
        end;
        if (trim (d.UserField3) != "")
          strDoc2 = trim(d.UserField3);
        end;

      elif (index (StrUpr (d.Receiver), "ПАСПОРТ") > 0)
        doc = "Предъявлен документ, удостоверяющий личность:" + " " + d.Receiver;
        strsplit (doc, SD, 1, 105, 1);
        strDoc1 = SD(0);
        strDoc2 = trim (substr (doc, strlen (SD(0)) + 1));

      else
        ClearRecord (acc);
        acc.Account = d.Account_Payer;
        if (GetEQ (acc) and GetClientPassport (acc.Client, @nameDoc, @numbDoc, @placeDoc, @dateDoc))
          strDoc1 = "Предъявлен документ, удостоверяющий личность:" + " " + nameDoc + " № " + numbDoc;
          strDoc2 = "Выдан" + " " + placeDoc + " " + dateDoc;
        end;
      end;
    end;

    doc = GetDover (d.Account_Payer, d.iApplicationKind, d.ApplicationKey);
    if (doc != "")
      strsplit (doc, SD, 1, 105, 1);
      strDoc1 = SD(0);
      strDoc2 = trim (substr (doc, strlen (SD(0)) + 1));
    end;

    [E(3R(s0p14h0s3b4102T&l8D&l0O
                                                                                                 +------------------+
                                                                                                 |    Код формы     |
                                                                                                 | документа по ОКУД|
                                                                                                 +------------------+
                                                                                                 |     0402009      |
                                                                                                 +------------------+

                                                                                          +- - - - - - - - - - - - -+
                                    +-------+                                                   Отрывной талон
         Расходный кассовый ордер № |#######|                                             |  к расходному кассовому |
                                    +-------+                                                  ордеру № #######
           #####################                                                          |             -------     |
           ---------------------                                                          +- - - - - - - - - - - -  +
                                                                            
                                                                       ДЕБЕТ              +-------------------------+
                                                           +------------------------------+   Место для наклейки    |
        Выдать                                             |Счет № #######################|   отрывного талона      |
        ###################################################+------------------------------+-------------------------+
        ###################################################                               |                         |
        ###################################################                               |                         |
    ]( d.Numb_Document:c,
       d.Numb_Document:c,
       strDateDoc:c,
       d.Account_Payer,
       NSPN(0),
       NSPN(1),
       NSPN(2));

    n = 3;
    while ((NSPN(n+1)!="") AND (n<6))
    [   ###################################################                               |                         |]( NSPN(n):l);
      n = n+1;
    end;

    [   ###################################################            КРЕДИТ             | ######################  |
        ---------------------------------------------------+------------------------------+                         |
        Наименование банка ################################|Счет № #######################|      Сумма цифрами      |
        ---------------------------------------------------+------------------------------+-------------------------+
    ]( NSPN(n),
       Sum:c,
       SBRN(0),
       d.Account_Receiver);

    n = 1;
    while ( SBRN(n+1) != "" )
    [   ################################################################################# |                         |
        ----------------------------------------------------------------------------------+                         |
    ] ( SBRN(n));
    n = n+1;
    end;


    [   ###############################################################   БИК  #########  |     в том числе         |
        ---------------------------------------------------------------       ------------+     по символам:        |
        Сумма прописью с указанием наименования валюты ################################   |                         |
        ----------------------------------------------------------------------------------+------+------------------+
        ###############################################################################   |символ|     сумма        |
        ----------------------------------------------------------------------------------+------+------------------+
        Направление выдачи ############################################################   | #### |##################|
        ----------------------------------------------------------------------------------+------+------------------+
    ]
   (  SBRN(n),
      BIC_Receiver,
      SS(0):l,
      SS(1):l,
      SG(0),
      Symb(0):c,
      SymbSum(0):f:r
    );


    if ( (Symb(1) == "") OR ( (Symb(1) != "") AND (Symb(2) == "") ) OR  ( (Symb(1) != "") AND (Symb(2) != "") AND ((Symb(3) == ""))))
    [   ################################################################################  | #### |##################|
        ----------------------------------------------------------------------------------+------+------------------+]
    (
      SG(1),
      Symb(1):c,
      SymbSum(1):f:r
    );
    j = 2;
    else
        j = 1;
        while ( j< i-1 )
        [   ################################################################################  | #### |##################|
            ----------------------------------------------------------------------------------+------+------------------+]
        (
            SG(j),
            Symb(j):c,
            SymbSum(j):f:r
        );
        j = j+1;
        end;
    end;

    [   ################################################################################  | #### |##################|
        ----------------------------------------------------------------------------------+------+------------------+
        #########################################################################################################
        ------------------------------------------------------------------------------------------------------------
                                                         (наименование документа)
        #########################################################################################################
        ------------------------------------------------------------------------------------------------------------
                                                                    (кем выдан)
        Указанную в расходном кассовом ордере сумму получил
                                                              ______________________
                                                                (личная подпись)

        Бухгалтерский работник                    Контролер                  Кассовый работник
        ########################

        ________________________            ________________________       ________________________

    ]
    (
      SG(j),
      Symb(j):c,
      SymbSum(j):f:r,
      strDoc1,
      strDoc2:l:w,
      ""/*GetFioOper(d.Oper,true):c*/ );
 end;

 if((({oper} >= 28) AND ({oper} < 40)) OR ({oper} >= 9000)) /* Оперзал платежки печатает на лазерный принтер */
  [
  ];
 end;
end;


/*                   Приходно - расходный кассовый ордер    */
macro PrintORC(strDateDoc,Sum, StrPayDate,kind_doc)
Array SSP,SGR,SGP,S,SY,SD, SSR, SymbP, SymbSumP, SymbR, SymbSumR;
var  rc,i,k,ns,doc, nameDoc = "", numbDoc = "", placeDoc = "", dateDoc = "", strDoc1 = "", strDoc2 = "", BuhP, BuhR, Name_vn = "", str="",
     PNumbDoc, RNumbDoc, PayerP, PayerR, ReceiverP, ReceiverR, PBank_Pay, RBank_Pay, RBank_Rec, PBank_rec, Pdate, Rdate, Psum, Rsum, NamePayer, NameReceiver ;
var cl  = TBFile("client.dbt", "R", 0, "client.dbt", "bank.def"), val = TArray(0, 1), NM = TArray(0, 1), NM1 = TArray(0, 1), NM2 = TArray(0, 1);

   strsplit( rubtostralt( d.Sum ), SSP,   32,17,20 );
   strsplit( rubtostralt( d.Sum ), SSR,   31,16,20 );
   strsplit( d.Ground,             SGP,   52,42,2 );
   strsplit( d.Ground,             SGR,   51,41,2 );

   if (d.MFO_Receiver == "")   /* получить инициалы для графы Вноситель*/
     ClearRecord(cl);
     cl.Rec.Name_client = d.Receiver;
     cl.keynum = 10;
     if ( cl.GetEQ() and (cl.Rec.LegalForm == "2"))
        Name_vn = cl.Rec.szShortName;
     end;
   end;

   if (Name_vn == "")
    Name_vn = d.Receiver;
   end;

   NM = strsplit2( Name_vn, 25, true, 13);

   StrSet(strDateDoc, strlen(strDateDoc), "о");
   strDateDoc = strDateDoc + "да";

   SetDocParm( acc, d.Account_Payer, d.Code_Currency, @nameDoc, @numbDoc, @placeDoc, @dateDoc );

    if (nameDoc != "")
        strDoc1 = nameDoc + " № " + numbDoc;
        strDoc2 = "Выдан" + " " + placeDoc + " " + dateDoc;
        strDoc1 = String(strDoc1:52);
        strDoc2 = string(strDoc2:52);
    end;

    /*   Кассовые символы  */
    i = 0;
    while ( i < 20)
        SymbR(i) = "";
        SymbSumR(i) = "";
        SymbP(i) = "";
        SymbSumP(i) = "";
        i = i+1;
    end;

    i = 0; k = 1;
    sc.Kind             = 1;
    sc.iApplicationKind = d.iApplicationKind;
    sc.ApplicationKey   = d.ApplicationKey;

    if(GetEQ(sc))
        if ( CheckTS( sc.Symbol, LSTS_DECR ) )
           SymbR(0)    = sc.Symbol;
           SymbSumR(0) = sc.Sum;
        else
           SymbR(0)    = "";
           SymbSumR(0) = "";
        end;
        if ( CheckTS( sc.Symbol, LSTS_INCR ) )
           SymbP(0)    = sc.Symbol;
           SymbSumP(0) = sc.Sum;
        else
           SymbP(0)    = "";
           SymbSumP(0) = "";
        end;
    else
        if ( CheckTS( d.Symbol_Cach, LSTS_DECR ) )
           SymbR(0)    = d.symbol_cach;
           SymbSumR(0) = d.Sum;
        else
           SymbR(0)    = "";
           SymbSumR(0) = "";
        end;
        if ( CheckTS( d.Symbol_Cach, LSTS_INCR ) )
           SymbP(0)    = d.symbol_cach;
           SymbSumP(0) = d.Sum;
        else
           SymbP(0)    = "";
           SymbSumP(0) = "";
        end;

    end;

    While(next(sc)
         and (sc.Kind             == 1                  )
         and (sc.iApplicationKind == d.iApplicationKind )
         and (sc.ApplicationKey   == d.ApplicationKey   ) )
       if ( CheckTS( sc.Symbol, LSTS_DECR ) )
          SymbR(i)    = sc.Symbol;
          SymbSumR(i) = sc.Sum;
          i = i + 1;
       end;
       if ( CheckTS( sc.Symbol, LSTS_INCR ) )
          SymbP(k)    = sc.Symbol;
          SymbSumP(k) = sc.Sum;
          k = k + 1;
       end;
    end;

    j = 0;
    While( j < i )
       if ((ValType(SymbP(j)) == V_UNDEF) and (ValType(SymbSumP(j)) == V_UNDEF))
          SymbP(j)="";
          SymbSumP(j)="";
       end;
       j = j + 1;
    end;

    j = 0;
    While( j < k )
       if ((ValType(SymbR(j)) == V_UNDEF) and (ValType(SymbSumR(j)) == V_UNDEF))
          SymbR(j)="";
          SymbSumR(j)="";
       end;
       j = j + 1;
    end;


   RNumbDoc = d.Numb_Document;
   PNumbDoc = d.Numb_Document;
   Pdate = StrDateDoc;
   Rdate = StrDateDoc;
   NameReceiver = d.Receiver;
   NamePayer = d.Payer;
   PBank_Pay = d.Bank_Payer;
   RBank_Pay = PBank_Pay;
   RBank_Rec = d.Bank_Receiver;
   PBank_Rec = RBank_Rec;
   PSum = string(d.Sum:a);
   PSum = StrSubSt( PSum, ".", "-"); 
   RSum = Psum;
   PayerP = d.Account_Payer;
   PayerR = PayerP;
   ReceiverP = d.Account_Receiver;
   ReceiverR  = ReceiverP;
   BuhP = GetFioOper(d.Oper,true);
   BuhR = BuhP;

   NM1 = strsplit2( NameReceiver, 44, true, 12);
   NM2 = strsplit2( NamePayer,    44, true, 12);

   if ( kind_doc == 1) /*будет заполняться только приходная часть */
        RNumbDoc = "";
        Rdate = "";
        NamePayer = "";
        PayerR = "";
        RBank_Pay = "";
        RBank_Rec = "";
        Rsum = "";
        ReceiverR = "";
        BuhR = "";
        strsplit( "", SSR,   31, 16, 50 );
        strsplit( "", SGR,   51, 41, 5 );
        j = 0;
        while ( j < 20)
            SymbR(j) = "";
            SymbSumR(j) = "";
            j = j+1;
         end;
        strDoc1 = ""; strDoc2 = "";
        j=0;
        while ( j<12 )
            NM2(j)="";
            j=j+1;
       end;
   elif ( kind_doc == 2) /*будет заполняться только расходная часть */
        PNumbDoc = "";
        Pdate = "";
        NameReceiver = "";
        PayerP = "";
        PBank_Pay = "";
        PBank_Rec = "";
        Psum = "";
        ReceiverP = "";
        BuhP = "";
        strsplit( "", SSP,   32, 17, 50 );
        strsplit( "", SGP,   52, 42, 5 );
        j = 0;
        while ( j < 20)
            SymbP(j) = "";
            SymbSumP(j) = "";
            j = j+1;
         end;
        j=0;
        while ( j<12 )
            NM1(j) = "";
            NM(j)="";
            j=j+1;
       end;
 end;
   [

                                                                                               +-------------------+
                                                                                               |     Код формы     |
                                                                                               | документа по ОКУД |
                                                                                               +-------------------+
                                                                                               |      0402007      |
                                                                                               +-------------------+
                                               +-------+       |                                     +-------+
           Приходно-расходный кассовый ордер № |#######|       | Приходно-расходный кассовый ордер № |#######|
                                               +-------+       |                                     +-------+
           #####################                               | #####################
           ---------------------                               | ---------------------
                                                               |
           ПРИХОДНАЯ ЧАСТЬ                                     | РАСХОДНАЯ ЧАСТЬ
                                                               |
           От кого ############################################| Выдать ############################################
   ]
   (
           PNumbDoc:c,      RNumbDoc:c,
           Pdate:c,         Rdate:c,
           NM1(0):l,  NM2(0):l
   );

      i=1;
      while(i<12)
        if ( (NM1(i)!="") OR (NM2(i)!="") )
   [               ############################################|        ############################################] (NM1(i), NM2(i));
        else
            break;
        end;
      i=i+1;
      end;


   [       ----------------------------------------------------+----------------------------------------------------
                     (фамилия, имя, отчество)                  |              (фамилия, имя, отчество)
           Банк-отправитель ###################################| Банк-получатель ###################################
           ----------------------------------------------------+----------------------------------------------------
           Банк-получатель ####################################| Банк-отправитель ##################################
           --------------------------------+-------------------+-------------------------------+-------------------+
                                           |   Сумма цифрами   |                               |   Сумма цифрами   |
                         ДЕБЕТ             | ##################|           ДЕБЕТ               | ##################|
           +-------------------------------+-------------------++------------------------------+-------------------+
           |Счет № ########################|   в том числе     ||Счет № #######################|   в том числе     |
           +-------------------------------+   по символам:    |+------------------------------+   по символам:    |
                         КРЕДИТ            |                   |           КРЕДИТ              |                   |
           +-------------------------------+------+------------++------------------------------+------+------------+
           |Счет № ########################|символ|  сумма     ||Счет № #######################|символ|  сумма     |
           +-------------------------------+------+------------++------------------------------+------+------------+
           Сумма прописью #################| #### |############|Сумма прописью ################| #### |############|
           --------------------------------+------+------------+-------------------------------+------+------------+
   ]
   (
           PBank_Pay:l,     RBank_Rec:l,
           PBank_Rec:l,     RBank_Pay:l,
           PSum:r,          RSum:r,
           PayerP:l,        PayerR:l,
           ReceiverP:l,     ReceiverR:l,
           SSP(0):l,        SymbP(0):c,      SymbSumP(0):f:r,    SSR(0):l,          SymbR(0):c,      SymbSumR(0):f:r
   );

    
        [       ################################| #### |############|###############################| #### |############|
                --------------------------------+------+------------+-------------------------------+------+------------+
        ]
        (SSP(1):l,        SymbP(1):c,      SymbSumP(1):f:r,    SSR(1):l,          SymbR(1):c,      SymbSumR(1):f:r);
        j = 2;
        while ( (SymbP(j+1) != "") OR  (SymbR(j+1) != ""))
        [       ################################| #### |############|###############################| #### |############|
                --------------------------------+------+------------+-------------------------------+------+------------+
        ]
        (SSP(j):l,        SymbP(j):c,      SymbSumP(j):f:r,    SSR(j):l,          SymbR(j):c,      SymbSumR(j):f:r);
        j = j+1;
        end;   
  
   [       ################################| #### |############|###############################| #### |############|
           --------------------------------+------+------------+-------------------------------+------+------------+
           Основание ##########################################|Основание ##########################################
                     ------------------------------------------|          ------------------------------------------
           ####################################################|####################################################
           ----------------------------------------------------|----------------------------------------------------
                                                               |
           Вноситель                  #########################|Бухгалтерский               #########################
    ] (
           SSP(j):l,        SymbP(j):c,      SymbSumP(j):f:r,    SSR(j):l,          SymbR(j):c,      SymbSumR(j):f:r,
           SGP(0):l,        SGR(0):l,
           SGP(1):l,        SGR(1):l,
           NM(0):l,         BuhR:l
      );

        i=1;
        while ( (NM(i) != "") AND ( i<13 ) )
   [                                  #########################|] (NM(i));
             i=i+1;
        end;



   [                  --------------- -------------------------| работник     ---------------  ---------------------
                      (личная подпись)    (фамилия и инициалы) |              (личная подпись)  (фамилия и инициалы)
                                                               |
           Бухгалтерский                #######################|Контролер
           работник      -------------- -----------------------|           ---------------  ------------------------
                         (личная подпись) (фамилия и инициалы) |           (личная подпись)  (фамилия и инициалы)
                                                               |
           Получил кассовый                                    |Получил по документу, удостоверяющему личность,
           работник                                            |####################################################
                          --------------  ---------------------|----------------------------------------------------
                         (личная подпись) (фамилия и инициалы) |####################################################
                                                               |----------------------------------------------------
                                                               |(наименование документа, номер, кем и когда выдан)
                                                               |
                                                               |Выдал кассовый
                                                               |работник        -------------  ---------------------
                                                               |               (личная подпись) (фамилия и инициалы)
   ]
   (
    BuhP:l,
    strDoc1:l,
    strDoc2:l
   );
end;

 macro PutPlat ( ptr, NumbCopy, action, repname, sf)

  Var   Payer,
        Receiver,
        BIC_Payer,
        CorAcc_Payer,
        BIC_Receiver,
        CorAcc_Receiver,
        dateDoc,DayDateDoc,
        strDateDoc,
        SumStr,  Sum = "",
        StrPayDate,
        inn, kpp, inn_kpp, BS,
        cp, Buhg,it,stat,menu_name,
        mask_ocp, err, Num_p = 0, NumDel = 0,
        okato="",
        cl  = TBFile("client.dbt", "R", 0, "client.dbt", "bank.def"), val = TArray(0, 1), date_318P, data, it1;

  var ac = TBFile("account.dbt", "R", 0, "account.dbt", "bank.def"), client;
  array menu_item, menu_items;
  record ind (arhdoc, "bank.def");

  if ( action == 3 )
       GlobalReport.SetCurSheet( 0 );
       while( Num_p < GlobalReport.GetCountSheet() )
          if ( GlobalReport.GetCurSheet.GetArrPrintStr().size == 0 )
             GlobalReport.SetExecute( string("iBook.Sheets.Item("+ String( Num_p + 1 - NumDel )+").Delete") );
             NumDel = NumDel + 1;
          end;
          Num_p = Num_p + 1;
          if ( Num_p < GlobalReport.GetCountSheet() )
            GlobalReport.SetZoomType(ZOOM_TYPE_A4,1,Num_p);
            GlobalReport.SetCurSheet( Num_p );
          end;
       end;
       GlobalReport.SetExecute( "iSheet=iBook.Sheets.Item(1)" );
  end;

   stat = SetParmPlat( NumbCopy, action, repname );
   if ( (stat != 2) AND (stat != 0) )
       return 0;
   end;

  if (КоличествоКопий == 0)
    if ( not GetInt(КоличествоКопий,"Введите количество копий.",3))
      exit(1);
    end;
  end;

  setbuff( ind, ptr );
  if ( not ИсключитьОВП(ind, d) )

      if   ( GetIdentProgram == 129 )   /*  129 - МВОДБ  */
          exit(1);
      elif ( GetIdentProgram == 142 ) /*  142 - Отчеты Банка  */
          return;
      end;
  end;

  it=-1;
  it1 = -1;

  DocToInn( d, 0, 0, inn, kpp );
   inn_kpp = "";

   if ( inn > "" )
      inn_kpp = "ИНН " + inn + " ";
      if ( kpp > "" )
         inn_kpp = inn_kpp + "КПП " + kpp + " ";
      end;
   end;

  Payer = inn_kpp + d.Payer;

  DocToInn( d, 0, 1, inn, kpp );
   inn_kpp = "";
   if ( inn > "" )
      inn_kpp = "ИНН " + inn + " ";
      if ( kpp > "" )
         inn_kpp = inn_kpp + "КПП " + kpp + " ";
      end;
   end;

  Receiver = inn_kpp + d.Receiver;

  /*ОКАТО*/
  if( (d.MFO_Receiver == "") AND (d.MFO_Payer == "")  )
  ClearRecord(ac);
  ac.Rec.Account = d.Account_Receiver;
  if ( ac.GetEQ())
    client = ac.Rec.Client;
  end; 
  end; 
  if ( client)
        if ( GetCtgVal( 3, 335, GetClientID(client), val ) )
            okato = SubStr(val[0], 1, 11);
        end;
    end;

   if( d.MFO_Payer == "" )
      BIC_Payer = {MFO_Bank};
      CorAcc_Payer = {CORAC_Bank};
   else
      BIC_Payer = d.MFO_Payer;
      CorAcc_Payer = d.CorAcc_Receiver;
   end;

   if( d.MFO_Receiver == "" )
      BIC_Receiver = {MFO_Bank};
      CorAcc_Receiver = {CORAC_Bank};
   else
      BIC_Receiver = d.MFO_Receiver;
      CorAcc_Receiver = d.CorAcc_Receiver;
   end;

   if( d.SaveAutoKey > 0 )
      dateDoc = d.Date_Carry;    /* Архивный документ */
   else
      dateDoc = d.Date_Document; /* Документ текущего дня */
   end;

   if(sf AND (dateDoc>{curdate}))
     dateDoc={curdate};
   end;

   strDateDoc = String(dateDoc:f:m);
  // Sumstr = СуммаЦифрами(d.Sum);

  Sum = string( d.Sum:a);
  Sum = StrSubSt( Sum, ".", "-"); 

   if(d.Pay_Date != ZeroDate)
    StrPayDate = PutDatePoint(d.Pay_Date);
   else
    StrPayDate = "";
   end;

   GetRegistryValue("MVODB\\ДОКУМЕНТЫ\\ДАТА 318П", V_STRING, date_318P, err );
   data = Date(date_318P);

 BS = SubStr(d.Account_Payer,1,3);
 Buhg = GetFioOper(d.Oper,true);
 PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
/*
 menu_name = "Выберите форму для печати документа "+string(d.Numb_Document);
  if(PrintUNFFlag==false)
  while(NumbCopy>0)
  if( (Trim(d.Kind_Oper) == "3") AND (d.Shifr_Oper != "16"))

      if( ( BS == "202" ) AND ( SubStr(d.Account_Receiver,1,3) == "202" ) )
      /* СЧЕТ ДЕБЕТА И КРЕДИТА ПРИНАДЛЕЖИТ 202 */

          menu_item(0)="    Мемориальный ордер          ";
          menu_item(1)="    Приходный кассовый ордер    ";
          menu_item(2)="    Расходный кассовый ордер    ";
          menu_item(3)="    Приходно-расходный кассовый ордер    ";
          if(it<0)
             it = Menu(menu_item,null,menu_name);
             if(it <0)
               exit(1);
             end;
          end;
          if   ( it == 0 )
          /* МЕМОРИАЛЬНЫЙ ОРДЕР */
             PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
          elif ( it == 1 )
          /* ПРИХОДНЫЙ КАССОВЫЙ */
             PrintRC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato, data);
          elif ( it == 2 )
          /* РАСХОДНЫЙ КАССОВЫЙ */
             PrintOC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, data);
          elif ( it == 3 )
          /* ПРИХОДНО - РАСХОДНЫЙ КАССОВЫЙ */
             menu_items(0)="    Приходная и расходная части ";
             menu_items(1)="    Приходная часть    ";
             menu_items(2)="    Расходная часть    ";
             if(it1<0)
                it1 = Menu(menu_items,null,menu_name);
                if(it1 <0)
                    exit(1);
                end;
             end;

             PrintORC( strDateDoc, Sum, StrPayDate, it1 );
          end;

      elif( BS == "202" )
      /* СЧЕТ ДЕБЕТА ПРИНАДЛЕЖИТ 202 */

          if( d.Shifr_Oper == "04" )
            /*ОБЪЯВЛЕНИЕ НА ВЗНОС НАЛИЧНЫМИ*/
            PrintOVN(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato, data);
          else
             GetRegistryValue("REPORT\\OCP\\OCP_1", V_STRING, mask_ocp, err );
             if ( (err != REG_OK) )
                mask_ocp = "ОВП";
             end;
             ClearRecord( acc );
             keynum( acc, 0 );
             acc.Account = d.Account_Receiver;
             if ( GetEQ(acc) AND (mask_ocp != "") AND ( CompareStrWithMasks(mask_ocp, acc.Balance) == 0 ) )
                /* БАЛАНСОВЫЙ СЧЕТА КРЕДИТА ОПИСАН В REPORT\\OCP\\OCP_1 */
                asize( menu_item, 0 );
                menu_item(0)="    Мемориальный ордер          ";
                menu_item(1)="    Приходный кассовый ордер    ";
                it = Menu(menu_item,null,menu_name);
                if(it <0)
                  exit(1);
                end;
                if ( it == 0 )
                   /* МЕМОРИАЛЬНЫЙ ОРДЕР */
                   PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
                else
                   /*ПРИХОДНЫЙ КАССОВЫЙ*/
                   PrintRC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato,  data);
                end;
             else
                /*ПРИХОДНЫЙ КАССОВЫЙ*/
                PrintRC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato,  data);
             end;
          end;

      elif( SubStr(d.Account_Receiver,1,3) == "202" )
      /* СЧЕТ КРЕДИТА ПРИНАДЛЕЖИТ 202 */

         GetRegistryValue("REPORT\\OCP\\OCP_1", V_STRING, mask_ocp, err );
         if ( (err != REG_OK) )
            mask_ocp = "ОВП";
         end;
         ClearRecord( acc );
         keynum( acc, 0 );
         acc.Account = d.Account_Payer;
         if ( GetEQ(acc) AND (mask_ocp != "") AND ( CompareStrWithMasks(mask_ocp, acc.Balance) == 0 ) )
            /* БАЛАНСОВЫЙ СЧЕТА ДЕБЕТА ОПИСАН В REPORT\\OCP\\OCP_1 */
            asize( menu_item, 0 );
            menu_item(0)="    Мемориальный ордер          ";
            menu_item(1)="    Расходный кассовый ордер    ";
            it = Menu(menu_item,null,menu_name);
            if(it <0)
              exit(1);
            end;
            if ( it == 0 )
               /* МЕМОРИАЛЬНЫЙ ОРДЕР */
               PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
            else
               /*РАСХОДНЫЙ КАССОВЫЙ*/
               PrintOC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, data);
            end;
         else
            /*РАСХОДНЫЙ КАССОВЫЙ*/
            PrintOC(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, data);
         end;

      else
      /* ни то, ни то ничему не принадлежит */

         /* МЕМОРИАЛЬНЫЙ ОРДЕР */
         PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
      end;

  else
    PrintMO(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
  end;
     NumbCopy=NumbCopy-1;
  end;
  else

  if( (Trim(d.Kind_Oper) == "3") AND (d.Shifr_Oper != "16"))

      if( ( BS == "202" ) AND ( SubStr(d.Account_Receiver,1,3) == "202" ) )
      /* СЧЕТ ДЕБЕТА И КРЕДИТА ПРИНАДЛЕЖИТ 202 */

          menu_item(0)="    Мемориальный ордер          ";
          menu_item(1)="    Приходный кассовый ордер    ";
          menu_item(2)="    Расходный кассовый ордер    ";
          menu_item(3)="    Приходно-расходный кассовый ордер    ";
          if(it<0)
             it = Menu(menu_item,null,menu_name);
             if(it <0)
               exit(1);
             end;
          end;
          if   ( it == 0 )
          /* МЕМОРИАЛЬНЫЙ ОРДЕР */
             PrintReportRMO(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
          elif ( it == 1 )
          /* ПРИХОДНЫЙ КАССОВЫЙ */
             PrintReportRP(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato,  data);
          elif ( it == 2 )
          /* РАСХОДНЫЙ КАССОВЫЙ */
             PrintReportRR(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, data);
          elif ( it == 3 )
          /* ПРИХОДНО - РАСХОДНЫЙ КАССОВЫЙ */
             menu_items(0)="    Приходная и расходная части ";
             menu_items(1)="    Приходная часть    ";
             menu_items(2)="    Расходная часть    ";
             if(it1<0)
                it1 = Menu(menu_items,null,menu_name);
                if(it1 <0)
                    exit(1);
                end;
             end;

             PrintReportRPR(d, strDateDoc, Sum, StrPayDate, it1);

          end;

      elif( BS == "202" )
      /* СЧЕТ ДЕБЕТА ПРИНАДЛЕЖИТ 202 */

          if( d.Shifr_Oper == "04" )
            /*ОБЪЯВЛЕНИЕ НА ВЗНОС НАЛИЧНЫМИ*/
            PrintOVN(Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp,  okato, data);
            PrintReportROV(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp,  okato, data);
            if ( ( GlobalReport.GetCountSheet() == 1 ) AND ( action == 0 ) )
                if ( NOT GlobalReport.IsDataExist( TRUE ) )
                    action = 1;
                end;
            end;

          else
             GetRegistryValue("REPORT\\OCP\\OCP_1", V_STRING, mask_ocp, err );
             if ( (err != REG_OK) )
                mask_ocp = "ОВП";
             end;
             ClearRecord( acc );
             keynum( acc, 0 );
             acc.Account = d.Account_Receiver;
             if ( GetEQ(acc) AND (mask_ocp != "") AND ( CompareStrWithMasks(mask_ocp, acc.Balance) == 0 ) )
                /* БАЛАНСОВЫЙ СЧЕТА КРЕДИТА ОПИСАН В REPORT\\OCP\\OCP_1 */
                asize( menu_item, 0 );
                menu_item(0)="    Мемориальный ордер          ";
                menu_item(1)="    Приходный кассовый ордер    ";
                it = Menu(menu_item,null,menu_name);
                if(it <0)
                  exit(1);
                end;
                if ( it == 0 )
                   /* МЕМОРИАЛЬНЫЙ ОРДЕР */
                   PrintReportRMO(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
                else
                   /* ПРИХОДНЫЙ КАССОВЫЙ */
                   PrintReportRP(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato,  data);
                end;
             else
                /*ПРИХОДНЫЙ КАССОВЫЙ*/
                PrintReportRP(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, inn, kpp, okato,  data);
             end;
          end;

      elif( SubStr(d.Account_Receiver,1,3) == "202" )
      /* СЧЕТ КРЕДИТА ПРИНАДЛЕЖИТ 202 */

         GetRegistryValue("REPORT\\OCP\\OCP_1", V_STRING, mask_ocp, err );
         if ( (err != REG_OK) )
            mask_ocp = "ОВП";
         end;
         ClearRecord( acc );
         keynum( acc, 0 );
         acc.Account = d.Account_Payer;
         if ( GetEQ(acc) AND (mask_ocp != "") AND ( CompareStrWithMasks(mask_ocp, acc.Balance) == 0 ) )
            /* БАЛАНСОВЫЙ СЧЕТА ДЕБЕТА ОПИСАН В REPORT\\OCP\\OCP_1 */
            asize( menu_item, 0 );
            menu_item(0)="    Мемориальный ордер          ";
            menu_item(1)="    Расходный кассовый ордер    ";
            it = Menu(menu_item,null,menu_name);
            if(it <0)
              exit(1);
            end;
            if ( it == 0 )
               /* МЕМОРИАЛЬНЫЙ ОРДЕР */
               PrintReportRMO(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
            else
               /* РАСХОДНЫЙ КАССОВЫЙ */
               PrintReportRR(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg,  data);
            end;
         else
            /* РАСХОДНЫЙ КАССОВЫЙ */
            PrintReportRR(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg, data);
         end;

      else
      /* ни то, ни то ничему не принадлежит */

         /* МЕМОРИАЛЬНЫЙ ОРДЕР */
         PrintReportRMO(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
      end;

  else
    PrintReportRMO(d,Payer,Receiver,strDateDoc,Sum,BIC_Payer,CorAcc_Payer,BIC_Receiver,CorAcc_Receiver,StrPayDate,Buhg);
  end;

  end;
*/
  if(action==0)
     if(NumbCopy > 1)
        GlobalReport.PrintRepCopy(NumbCopy-1);
        println("");
     end;
     SetParmPlat( NumbCopy, 3, repname );
  end;

  end;

 macro PutPlatMO ( ptr, NumbCopy, action, repname, sf)
    PutPlat ( ptr, NumbCopy, action, repname, sf);
 end;
